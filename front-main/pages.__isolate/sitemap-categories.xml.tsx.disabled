import { GetServerSideProps } from 'next';

const CategoriesSitemap = () => {
  return null;
};

export const getServerSideProps: GetServerSideProps = async ({ res }) => {
  const baseUrl = process.env.NEXT_PUBLIC_FRONTEND_URL || 'https://inbola.uz';
  
  // TODO: In production, fetch from your API
  // const categories = await fetchAllCategories();
  
  // Mock category data
  const categories = [
    {
      slug: 'toys',
      name: 'O\'yinchoqlar',
      lastmod: '2024-01-15T08:00:00Z',
      priority: '0.9',
      changefreq: 'weekly',
      subcategories: [
        'construction-toys',
        'educational-toys',
        'stuffed-animals',
        'action-figures',
        'board-games'
      ]
    },
    {
      slug: 'books',
      name: 'Kitoblar',
      lastmod: '2024-01-14T08:00:00Z',
      priority: '0.9',
      changefreq: 'weekly',
      subcategories: [
        'picture-books',
        'educational-books',
        'story-books',
        'uzbek-books',
        'russian-books'
      ]
    },
    {
      slug: 'education',
      name: 'Ta\'lim',
      lastmod: '2024-01-13T08:00:00Z',
      priority: '0.9',
      changefreq: 'weekly',
      subcategories: [
        'learning-materials',
        'science-kits',
        'art-supplies',
        'musical-instruments',
        'math-games'
      ]
    },
    {
      slug: 'clothes',
      name: 'Kiyim-kechak',
      lastmod: '2024-01-12T08:00:00Z',
      priority: '0.8',
      changefreq: 'weekly',
      subcategories: [
        'baby-clothes',
        'kids-clothing',
        'shoes',
        'accessories',
        'seasonal-wear'
      ]
    },
    {
      slug: 'sports',
      name: 'Sport',
      lastmod: '2024-01-11T08:00:00Z',
      priority: '0.8',
      changefreq: 'weekly',
      subcategories: [
        'outdoor-toys',
        'bikes-scooters',
        'sports-equipment',
        'water-toys',
        'playground-equipment'
      ]
    },
    {
      slug: 'electronics',
      name: 'Elektronika',
      lastmod: '2024-01-10T08:00:00Z',
      priority: '0.8',
      changefreq: 'weekly',
      subcategories: [
        'kids-tablets',
        'educational-electronics',
        'remote-control-toys',
        'robots',
        'smart-toys'
      ]
    }
  ];

  // Generate URLs for main categories and subcategories
  const allUrls = [];
  
  categories.forEach(category => {
    // Main category
    allUrls.push({
      url: `/categories/${category.slug}`,
      lastmod: category.lastmod,
      priority: category.priority,
      changefreq: category.changefreq,
      type: 'main-category'
    });
    
    // Subcategories
    category.subcategories.forEach(subcat => {
      allUrls.push({
        url: `/categories/${category.slug}/${subcat}`,
        lastmod: category.lastmod,
        priority: '0.7',
        changefreq: 'weekly',
        type: 'subcategory'
      });
    });
  });

  const sitemap = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\"
        xmlns:image=\"http://www.google.com/schemas/sitemap-image/1.1\"
        xmlns:xhtml=\"http://www.w3.org/1999/xhtml\">
  ${allUrls
    .map((item) => {
      return `
    <url>
      <loc>${baseUrl}${item.url}</loc>
      <lastmod>${item.lastmod}</lastmod>
      <changefreq>${item.changefreq}</changefreq>
      <priority>${item.priority}</priority>
      ${item.type === 'main-category' ? `
      <image:image>
        <image:loc>${baseUrl}/img/categories/${item.url.split('/').pop()}.jpg</image:loc>
        <image:title>Category Image</image:title>
        <image:caption>INBOLA Kids Marketplace Category</image:caption>
      </image:image>` : ''}
      <!-- Multilingual category pages -->
      <xhtml:link rel=\"alternate\" hreflang=\"uz\" href=\"${baseUrl}/uz${item.url}\" />
      <xhtml:link rel=\"alternate\" hreflang=\"ru\" href=\"${baseUrl}/ru${item.url}\" />
      <xhtml:link rel=\"alternate\" hreflang=\"en\" href=\"${baseUrl}/en${item.url}\" />
    </url>
  `;
    })
    .join('')}
</urlset>`;

  res.setHeader('Content-Type', 'text/xml');
  res.setHeader('Cache-Control', 'public, s-maxage=3600, stale-while-revalidate=86400');
  res.write(sitemap);
  res.end();

  return {
    props: {},
  };
};

export default CategoriesSitemap;